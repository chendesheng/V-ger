<html ng-app>
<head>
	<title>V'ger</title>
	<link href="/assets/style.css" rel="stylesheet" type="text/css">
	<script src="/assets/angular.min.js"></script>
	<script type="text/javascript" src="/assets/main.js"></script>
	<script type="text/javascript" src="/assets/date.js"></script>
</head>
<body>
	<!--for debug-->
	<input type="button" id="refresh-tasks" value="Refresh" style="display:none;" />

	<h1>V'ger</h1>
	<h2>Speed is Fun!</h2>
	<div id="tasks" ng-controller="tasks_ctrl">
		<ul id="tasks-list">
	       <li ng-repeat="task in tasks | orderBy:'StartTime':1">
	       		<div class="task-infoes">
	       			<div class="left-actions">
		       			<button class="resume" ng-click="send_resume(task)" ng-show="task.Status=='Stopped'"></button>
		       			<button class="stop" ng-click="send_stop(task)" ng-show="task.Status=='Downloading'"></button>
		       		</div>
	       			<div><span class="name"><a ng-click="send_open(task)">{{task.Name}}</a></span></div>

			       	<div class="progress">
			       		<div ng-class="{downloading:task.Status=='Downloading',stopped:task.Status!='Downloading'}" style="width:{{(task.DownloadedSize/task.Size*500).toFixed(0)}}px;"></div>
		       		</div>

		       		<div class="row-3rd">
		       			<input type="button" ng-click="search_subtitles(task.Name)" value="Subtitles"/>
		       			<select ng-hide="task.Status=='Finished'" ng-model="task.LimitSpeed" class="action-limit" ng-change="send_limit(task)">
		       				<option value="0">No limit</option>
		       				<option value="50">Up to 50K</option>
		       				<option value="100">Up to 100K</option>
		       				<option value="150">Up to 150K</option>
		       				<option value="200">Up to 200K</option>
		       				<option value="300">Up to 300K</option>
		       				<option value="500">Up to 500K</option>
		       			</select>

		       			<span ng-hide="task.Status=='Finished'">
			       			<input id="autoshutdown-{{task.NameHash}}" type="checkbox" ng-model="task.Autoshutdown" ng-click="set_autoshutdown(task)" />
			       			<label for="autoshutdown-{{task.NameHash}}">Shutdown after finish</label>
		       			</span>

		       			<span ng-show="task.Status=='Downloading'" class="info">Est. {{parse_duration(task.Est)}}</span>
		       			<span ng-show="task.Status=='Downloading'" class="info">{{task.Speed.toFixed(2)}}KB/s</span>

			       		<span ng-show="task.Status!='Downloading'" class="elapsed info">Elapsed. {{parse_duration(task.ElapsedTime)}}</span>
			       		<span ng-show="task.Status!='Downloading'" class="info">{{parse_time(task.StartTime)}}</span>

		       		</div>

	       			<!-- <div>
			       		<span style="display:none;">[{{task.StartDate.format()}}]</span>
			       		<span style="display:none;" class="elapsed">Elapsed. {{parse_duration(task.ElapsedTime)}}</span>
			       	</div> -->

	       			<button class="close" ng-click="move_to_trash(task)" title="Trash"></button>
		     

	       		<div>
	       </li>
		</ul>
		<form ng-submit="go()">
			<div id="start-download">
				<textarea autofocus ng-model="new_url" type="text" id="new-url" placeHolder="Input anything you want"></textarea>
				<input id="new-task" type="submit" ng-hide="waiting" value="GO"/>
				<span ng-show="waiting" id="waiting"></span>
			</div>
		</form>

		<div id="bt-files-overlay" class="overlay" ng-show="bt_files.length > 0">
			<div id="bt-files" class="popup">
				<button class="close" ng-click="bt_files=[]"></button>
				<h3>Select a file ({{bt_files.length}} files total)</h3>
				<ul>
					<li ng-repeat="file in bt_files | orderBy:-Size">
						<span class="status">[{{get_bt_file_status(file.Percent)}}]</span>
						<span class="name">{{file.Name}}</span>
						<span class="size">{{file.Size}}</span>
						<input type="button" value="Download" ng-disabled="file.Percent<100" ng-hide="file.loading" ng-click="download_bt_files(file)"/>
						<span class="loading" ng-show="file.loading"></span>
					</li>
				</ul>
			</div>
		</div>


		<div id="nosubtitles-overlay" class="overlay" ng-show="nosubtitles">
			<div class="popup">
				<button class="close" ng-click="nosubtitles=false"></button>
				<h3>No subtitles for '{{subtitles_movie_name}}'</h3>
				<div class="bottom"><input type="button" value="Search in Google" ng-click="google_subtitles()"/></div>
			</div>
		</div>

		<div id="subtitles-overlay" class="overlay" ng-show="subtitles.length > 0">
			<div id="subtitles" class="popup">
				<button class="close" ng-click="subtitles=[]"></button>
				<h3>Subtitles for '{{subtitles_movie_name}}'</h3>
				<ul>
					<li ng-repeat="sub in subtitles | orderBy:-Size">
						<span class="name">{{sub.Description}}</span>
						<input type="button" value="Download" ng-hide="sub.loading" ng-click="download_subtitles(sub)"/>
						<span class="loading" ng-show="sub.loading"></span>
					</li>
				</ul>
			</div>
		</div>
	</div>
</body>
</html>